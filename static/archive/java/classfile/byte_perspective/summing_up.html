<!-- 标题 -->
<h1 class="w3-center w3-padding-64 w3-tangerine"><span class="w3-tag w3-wide">Summing Up</span></h1>
<!-- 内容 -->

<div style="text-align: right">
    <a title="Table Of Content" href="/archive/java/java_classfile_index.html">TOC</a>
    <a href="javascript:void(0);" onclick="toggle_all_sub_note()">Toggle Commentary</a>
</div>

<h2>Java Source Code VS Java Compiled Class</h2>

<p>
    There are however some differences between source and compiled classes:
</p>

<ul>
    <li>
        <b>A compiled class describes only one class, while a source file can contain several classes.</b>
        For instance a source file describing a class with one inner class is compiled in two class files: one for the main class and one for the inner class.
        However the main class file contains references to its inner classes, and inner classes defined inside methods contain a reference to their enclosing method.
    </li>
    <li>
        A compiled class does not contain comments, of course, but can contain class, field, method and code attributes that can be used to associate additional information to these elements.
    </li>
    <li>
        A compiled class does not contain a <code>package</code> and <code>import</code> section, so all type names must be fully qualified.
    </li>
    <li>
        Another very important <b>structural difference</b> is that a compiled class contains a constant pool section. This pool is an array containing all the numeric, string and type constants that appear in the class. These constants are defined only once, in the constant pool section, and are referenced by their index in all other sections of the class file.
    </li>
    <li>
        Another important difference is that Java types are represented differently in compiled and source classes.
    </li>
</ul>

<h2>Limitations of the Java Virtual Machine</h2>

<div title="ClassFile" class="plaintext">
ClassFile {
    u4             magic;
    u2             minor_version;
    u2             major_version;
    u2             constant_pool_count;
    cp_info        constant_pool[constant_pool_count-1];
    u2             access_flags;
    u2             this_class;
    u2             super_class;
    u2             interfaces_count;
    u2             interfaces[interfaces_count];
    u2             fields_count;
    field_info     fields[fields_count];
    u2             methods_count;
    method_info    methods[methods_count];
    u2             attributes_count;
    attribute_info attributes[attributes_count];
}
</div>

<p>
    The following limitations of the Java Virtual Machine are implicit in the class file format:
</p>

<ul>
    <li>
        <b>The per-class or per-interface constant pool</b> is limited to 65535 entries by the 16-bit <code>constant_pool_count</code> field of the <code>ClassFile</code> structure. This acts as an internal limit on the total complexity of a single class or interface.
    </li>
    <li>
        <b>The number of direct superinterfaces of a class or interface</b> is limited to 65535 by the size of the <code>interfaces_count</code> item of the <code>ClassFile</code> structure.
    </li>
    <li>
        <b>The number of fields</b> that may be declared by a class or interface is limited to 65535 by the size of the <code>fields_count</code> item of the <code>ClassFile</code> structure.
        Note that the value of the <code>fields_count</code> item of the <code>ClassFile</code> structure does not include fields that are inherited from superclasses or superinterfaces.
    </li>
    <li>
        <b>The number of methods</b> that may be declared by a class or interface is limited to 65535 by the size of the <code>methods_count</code> item of the <code>ClassFile</code> structure.
        Note that the value of the <code>methods_count</code> item of the <code>ClassFile</code> structure does not include methods that are inherited from superclasses or superinterfaces.
    </li>
</ul>

<div title="Code_attribute" class="plaintext">
Code_attribute {
    u2 attribute_name_index;
    u4 attribute_length;
    u2 max_stack;
    u2 max_locals;
    u4 code_length;
    u1 code[code_length];
    u2 exception_table_length;
    {   u2 start_pc;
        u2 end_pc;
        u2 handler_pc;
        u2 catch_type;
    } exception_table[exception_table_length];
    u2 attributes_count;
    attribute_info attributes[attributes_count];
}
</div>

<ul>
    <li>
        <b>The greatest number of local variables</b> in the local variables array of a frame created upon invocation of a method is limited to 65535 by the size of the <code>max_locals</code> item of the <code>Code</code> attribute giving the code of the method, and by the 16-bit local variable indexing of the Java Virtual Machine instruction set.

        Note that values of type <code>long</code> and <code>double</code> are each considered to reserve two local variables and contribute two units toward the <code>max_locals</code> value, so use of local variables of those types further reduces this limit.
    </li>
    <li>
        <b>The size of an operand stack in a frame</b> is limited to 65535 values by the <code>max_stack</code> field of the <code>Code</code> attribute.

        Note that values of type <code>long</code> and <code>double</code> are each considered to contribute two units toward the <code>max_stack</code> value, so use of values of these types on the operand stack further reduces this limit.
    </li>
</ul>

<ul>
    <li>
        <b>The number of method parameters</b> is limited to 255 by the definition of a method descriptor, where the limit includes one unit for <code>this</code> in the case of instance or interface method invocations.

        Note that a method descriptor is defined in terms of a notion of method parameter length in which a parameter of type <code>long</code> or <code>double</code> contributes two units to the length, so parameters of these types further reduce the limit.
    </li>
    <li>
        The length of field and method names, field and method descriptors, and other constant string values (including those referenced by <code>ConstantValue</code> attributes) is limited to 65535 characters by the 16-bit unsigned length item of the <code>CONSTANT_Utf8_info</code> structure.
        Note that the limit is on the number of bytes in the encoding and not on the number of encoded characters. UTF-8 encodes some characters using two or three bytes. Thus, strings incorporating multibyte characters are further constrained.
    </li>
    <li>
        <b>The number of dimensions in an array</b> is limited to 255 by the size of the dimensions opcode of the <code>multianewarray</code> instruction and by the constraints imposed on the <code>multianewarray</code>, <code>anewarray</code>, and <code>newarray</code> instructions.
    </li>
</ul>


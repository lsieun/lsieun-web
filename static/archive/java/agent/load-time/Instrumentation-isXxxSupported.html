<!-- 标题 -->
<h1 class="w3-center w3-padding-64 w3-tangerine"><span class="w3-tag w3-wide">Instrumentation.isXxxSupported()</span></h1>
<!-- 内容 -->

<div style="text-align: right">
    <a title="Table Of Content" href="../java-agent-index.html">TOC</a>
    <a href="javascript:void(0);" onclick="toggle_all_sub_note()">Toggle Commentary</a>
</div>

<h2>Intro</h2>

<ul>
    <li>
        <code>boolean isRedefineClassesSupported()</code>:
        Returns whether or not the current JVM configuration supports <strong>redefinition</strong> of classes.

    </li>
    <li>
        <code>boolean isRetransformClassesSupported()</code>:
        Returns whether or not the current JVM configuration supports <strong>retransformation</strong> of classes.
    </li>
    <li>
        <code>boolean isNativeMethodPrefixSupported()</code>:
        Returns whether the current JVM configuration supports <strong>setting a native method prefix</strong>.
    </li>
</ul>

<pre title="Instrumentation.java" class="javacode">
public interface Instrumentation {
    boolean isRedefineClassesSupported();
    boolean isRetransformClassesSupported();
    boolean isNativeMethodPrefixSupported();
}
</pre>

<ul>
    <li>
        <code>boolean isRedefineClassesSupported()</code>:
        <ul>
            <li>The ability to redefine an already loaded class is an optional capability of a JVM.</li>
            <li>
                Redefinition will only be supported
                if the <code>Can-Redefine-Classes</code> manifest attribute is set to <code>true</code> in the agent JAR file and
                the JVM supports this capability.
            </li>
            <li>
                During a single instantiation of a single JVM, multiple calls to this method will always return the same answer.
            </li>
        </ul>
    </li>
    <li>
        <code>boolean isRetransformClassesSupported()</code>:
        <ul>
            <li>The ability to retransform an already loaded class is an optional capability of a JVM.</li>
            <li>
                Retransformation will only be supported
                if the <code>Can-Retransform-Classes</code> manifest attribute is set to <code>true</code> in the agent JAR file and
                the JVM supports this capability.
            </li>
            <li>
                During a single instantiation of a single JVM, multiple calls to this method will always return the same answer.
            </li>
        </ul>
    </li>
    <li>
        <code>boolean isNativeMethodPrefixSupported()</code>:
        <ul>
            <li>The ability to set a native method prefix is an optional capability of a JVM.</li>
            <li>
                Setting a native method prefix will only be supported
                if the <code>Can-Set-Native-Method-Prefix</code> manifest attribute is set to <code>true</code> in the agent JAR file and
                the JVM supports this capability.
            </li>
            <li>
                During a single instantiation of a single JVM, multiple calls to this method will always return the same answer.
            </li>
        </ul>
    </li>
</ul>

<p>
    总结：
</p>

<ul>
    <li>
        第一，判断JVM是否支持该功能。
    </li>
    <li>
        第二，判断Java Agent Jar内的<code>MANIFEST.MF</code>文件里的配置是否为<code>true</code>。
    </li>
    <li>
        第三，在一个JVM实例当中，多次调用某个<code>isXxxSupported()</code>方法，该方法的返回值是不会改变的。
    </li>
</ul>

<h2 id="application">Application</h2>

<pre title="Program.java" class="javacode">
public class Program {
    public static void main(String[] args) {
        System.out.println("Hello Program");
    }
}
</pre>

<h2 id="java-agent-jar">Java Agent Jar</h2>

<h3 id="agent-class">Agent Class</h3>

<pre title="LoadTimeAgent.java" class="javacode">
import java.lang.instrument.Instrumentation;

public class LoadTimeAgent {
    public static void premain(String agentArgs, Instrumentation inst) {
        System.out.println("Premain-Class: " + LoadTimeAgent.class.getName());
        System.out.println("Can-Redefine-Classes: " + inst.isRedefineClassesSupported());
        System.out.println("Can-Retransform-Classes: " + inst.isRetransformClassesSupported());
        System.out.println("Can-Set-Native-Method-Prefix: " + inst.isNativeMethodPrefixSupported());
    }
}
</pre>

<h2 id="run-application">Run Application</h2>

<h3 id="run-without-agent">Run</h3>

<pre title="java sample.Program" class="plaintext">
$ java sample.Program
Hello Program
</pre>

<h3 id="run-with-agent">Run With Agent</h3>

<pre title="Run output" class="plaintext">
$ java -javaagent:D:/git-repo/learn-java-agent/target/TheAgent.jar sample.Program
Premain-Class: lsieun.agent.LoadTimeAgent
Can-Redefine-Classes: true
Can-Retransform-Classes: true
Can-Set-Native-Method-Prefix: true
Hello Program
</pre>


